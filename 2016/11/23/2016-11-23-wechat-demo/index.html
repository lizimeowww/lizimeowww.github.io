<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> 微信小程序的小练手 · lizimeow's blog</title><meta name="description" content="微信小程序的小练手 - lizimeow"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="short icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://yoursite.com/atom.xml" title="lizimeow's blog"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="http://weibo.com/lizimeow" target="_blank" class="nav-list-link">WEIBO</a></li><li class="nav-list-item"><a href="https://github.com/lizimeow" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/about/" target="_self" class="nav-list-link">ABOUT</a></li></ul></header><section class="container"><div class="post"><article class="post-block"><h1 class="post-title">微信小程序的小练手</h1><div class="post-info">2016年11月23日</div><div class="post-content"><blockquote>
<p>喵~</p>
</blockquote>
<p>微信小程序是一种不需要下载安装即可使用的应用，它实现了应用“触手可及”的梦想，用户扫一扫或搜一下即可打开应用。用完即走，适合场景化的问题。</p>
<p>微信推了小程序之后大家对它的关注度一直很高。所以就和朋神默默的写了个demo…</p>
<p style="color:#aaa;font-size:14px;">10月底写的小程序…现在11月都快过完了才写博客2333<em>(:зゝ∠)</em>……..</p>

<p><img src="2.gif" alt="2"></p>
<p>考虑了一下小程序用完即走的定位，我们做的这个东西功能十分的简单明确，就是用来进行活动的查看和签到，通过微信提供的位置的api获取坐标进行位置的判断。</p>
<p>因为功能比较简单所以就没有用脚手架….</p>
<h2 id="结构"><a href="#结构" class="headerlink" title="结构"></a>结构</h2><p> <img src="1.png" alt="1"></p>
<p>整个项目的结构大概如图，小程序结构还是比较清晰&amp;好理解的，<code>.js</code>脚本文件，<code>.json</code>配置文件，<code>.wxss</code>样式表文件 </p>
<p>app.json 是对整个小程序的全局配置,可以配置有你的项目哪些页面，tabBar，导航条，网络超时时间等。</p>
<p>app.js是小程序逻辑。在app.js里用<code>App()</code> 函数用来注册一个小程序。指定小程序的生命周期函数等。</p>
<p><strong>tips：</strong></p>
<p><strong>pages里的四个文件必须具有相同的路径与文件名。只能配置最少2个、最多5个 tab</strong> 。</p>
<h3 id="WXML"><a href="#WXML" class="headerlink" title="WXML"></a>WXML</h3><p>有以下几个功能，感觉跟vue差不多-  -….文档写的挺清楚的….没什么好讲的地方…</p>
<p><a href="https://mp.weixin.qq.com/debug/wxadoc/dev/framework/view/wxml/data.html?t=20161122" target="_blank" rel="external">数据绑定</a>、<a href="https://mp.weixin.qq.com/debug/wxadoc/dev/framework/view/wxml/list.html?t=20161122" target="_blank" rel="external">列表渲染</a>、<a href="https://mp.weixin.qq.com/debug/wxadoc/dev/framework/view/wxml/conditional.html?t=20161122" target="_blank" rel="external">条件渲染</a>、<a href="https://mp.weixin.qq.com/debug/wxadoc/dev/framework/view/wxml/template.html?t=20161122" target="_blank" rel="external">模板</a>、<a href="https://mp.weixin.qq.com/debug/wxadoc/dev/framework/view/wxml/event.html?t=20161122" target="_blank" rel="external">事件</a>、<a href="https://mp.weixin.qq.com/debug/wxadoc/dev/framework/view/wxml/import.html?t=20161122" target="_blank" rel="external">引用</a></p>
<h3 id="WXSS"><a href="#WXSS" class="headerlink" title="WXSS"></a>WXSS</h3><p>跟CSS几乎是一样，多扩展了两个特性，</p>
<ul>
<li><p>rpx（responsive pixel）: 可以根据屏幕宽度进行自适应。</p>
<p>rem（root em）: 规定屏幕宽度为20rem；1rem = (750/20)rpx 。</p>
</li>
<li><p>使用<code>@import</code>语句可以导入外联样式表，<code>@import</code>后跟需要导入的外联样式表的相对路径。</p>
</li>
</ul>
<h2 id="活动的排序"><a href="#活动的排序" class="headerlink" title="活动的排序"></a>活动的排序</h2><p>获取活动的数据，活动有三种状态，正在进行，即将开始，已结束。要令正在进行的活动排在活动列表的最前面，然后按照活动的开始时间进行排序。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">wx.request(&#123;</div><div class="line">        url,</div><div class="line">        <span class="attr">success</span>: <span class="function"><span class="params">resp</span> =&gt;</span> &#123;</div><div class="line">          <span class="keyword">const</span> now = <span class="keyword">new</span> <span class="built_in">Date</span>()</div><div class="line">          <span class="keyword">const</span> a = resp.data.data.map(<span class="function"><span class="params">i</span> =&gt;</span> &#123;</div><div class="line">            i.start = <span class="keyword">new</span> <span class="built_in">Date</span>(i.start)</div><div class="line">            i.end = <span class="keyword">new</span> <span class="built_in">Date</span>(i.end)</div><div class="line">            <span class="keyword">return</span> i</div><div class="line">          &#125;)</div><div class="line">          <span class="built_in">console</span>.log(<span class="string">"resp"</span>,resp)</div><div class="line">          <span class="keyword">const</span> cmp = <span class="function">(<span class="params">a, b</span>) =&gt;</span> b.start - a.start</div><div class="line">          <span class="keyword">const</span> coming = a.filter(<span class="function"><span class="params">i</span> =&gt;</span> i.start &gt; now).sort(cmp).map(<span class="function"><span class="params">i</span> =&gt;</span> (i.statu = <span class="number">0</span>,i))</div><div class="line">          <span class="keyword">const</span> ing = a.filter(<span class="function"><span class="params">i</span> =&gt;</span> i.start &lt; now &amp;&amp; i.end &gt; now).sort(cmp).map(<span class="function"><span class="params">i</span> =&gt;</span> (i.statu = <span class="number">1</span>,i))</div><div class="line">          <span class="keyword">const</span> end = a.filter(<span class="function"><span class="params">i</span> =&gt;</span> i.end &lt; now).sort(cmp).map(<span class="function"><span class="params">i</span> =&gt;</span> (i.statu = <span class="number">2</span>,i))</div><div class="line">          <span class="keyword">const</span> items = [...ing, ...coming, ...end].map(<span class="function"><span class="params">i</span> =&gt;</span> &#123;</div><div class="line">                                                    i.img = u + i.img</div><div class="line">                                                    i.time = util.formatTime(i.start)</div><div class="line">                                                    <span class="keyword">return</span> i</div><div class="line">                                                  &#125;)</div><div class="line">        </div><div class="line">          <span class="keyword">if</span> (items.length) &#123;</div><div class="line">            <span class="keyword">this</span>.setData(&#123;  <span class="attr">items</span>:that.data.items.concat(items), <span class="attr">loading</span>: <span class="literal">true</span> &#125;);</div><div class="line">          &#125; <span class="keyword">else</span> &#123;</div><div class="line">            <span class="keyword">this</span>.setData(&#123; <span class="attr">hasMore</span>: <span class="literal">false</span>, <span class="attr">loading</span>: <span class="literal">false</span> &#125;);</div><div class="line">          &#125;</div><div class="line">        &#125;,</div><div class="line">        <span class="attr">fail</span>: <span class="function"><span class="params">e</span> =&gt;</span> <span class="built_in">console</span>.log(e)</div><div class="line">      &#125;)</div></pre></td></tr></table></figure>
<p>活动列表的下拉加载遇到了一点坑。。</p>
<p>在wxml的代码里，需要对<code>scroll-view</code>给定一个固定的height，不然他不会有加载的效果，为了适配不同的分辨率，通过<code>wx.getSystemInfo</code>获取用户的窗口高度进行数据绑定。（WXML 中的动态数据均来自对应 Page 的 data）</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">"container"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">scroll-view</span> <span class="attr">scroll-y</span>=<span class="string">"true"</span> <span class="attr">style</span>=<span class="string">"height:&#123;&#123;windowH&#125;&#125;px"</span> <span class="attr">class</span>=<span class="string">"list"</span> <span class="attr">bindscrolltolower</span>=<span class="string">"handleLoadMore"</span> &gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">"wrap"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">"activity-box"</span>  <span class="attr">wx:for</span>=<span class="string">"&#123;&#123;items&#125;&#125;"</span> <span class="attr">wx:key</span>=<span class="string">"_id"</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">image</span> <span class="attr">src</span>=<span class="string">"&#123;&#123; item.img &#125;&#125;"</span> <span class="attr">class</span>=<span class="string">"img &#123;&#123; item.statu !== 1 ? 'mask' : '' &#125;&#125; &#123;&#123; item.statu === 0 ? 'coming' : '' &#125;&#125; &#123;&#123; item.statu === 2 ? 'end' : '' &#125;&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">image</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">"block"</span>&gt;</span>&#123;&#123; item.title &#125;&#125;<span class="tag">&lt;/<span class="name">text</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">"block time"</span>&gt;</span>&#123;&#123; item.time &#125;&#125;<span class="tag">&lt;/<span class="name">text</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">view</span>&gt;</span></div><div class="line">   <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">"tips"</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">view</span> <span class="attr">wx:if</span>=<span class="string">"&#123;&#123; hasMore &#125;&#125;"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">image</span> <span class="attr">src</span>=<span class="string">"../../image/loading.gif"</span> <span class="attr">mode</span>=<span class="string">"aspectFill"</span>/&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">text</span>&gt;</span>努力加载中_(:зゝ∠)_<span class="tag">&lt;/<span class="name">text</span>&gt;</span></div><div class="line">      <span class="tag">&lt;/<span class="name">view</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">view</span> <span class="attr">wx:else</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">text</span>&gt;</span>没有更多内容了<span class="tag">&lt;/<span class="name">text</span>&gt;</span></div><div class="line">      <span class="tag">&lt;/<span class="name">view</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">scroll-view</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></div></pre></td></tr></table></figure>
<p>总而言之，跟vue有一点点像。。&amp;<del>朋神一直在吐槽小程序的api很蠢</del>。。。<em>(:зゝ∠)</em>….</p>
</div></article></div></section><footer><div class="paginator"><a href="/2016/11/24/2016-11-24-解决Ruby gem被墙的问题/" class="prev">PREV</a><a href="/2015/11/16/2015-11-16-react-native android 在windows下的初体验/" class="next">NEXT</a></div><div id="disqus_thread"></div><script>var disqus_shortname = 'lizimeow';
var disqus_identifier = '2016/11/23/2016-11-23-wechat-demo/';
var disqus_title = '微信小程序的小练手';
var disqus_url = 'http://yoursite.com/2016/11/23/2016-11-23-wechat-demo/';
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//lizimeow.disqus.com/count.js" async></script><div class="copyright"><p>© 2015 - 2017 <a href="http://yoursite.com">lizimeow</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.6.1/MathJax.js?config=TeX-MML-AM_CHTML"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-65933410-1",'auto');ga('send','pageview');</script></body></html>